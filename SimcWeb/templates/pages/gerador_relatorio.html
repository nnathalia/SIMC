{% extends 'layout/layout.html' %} {% block title %} Relatorios {% endblock %}
{% block content %}
<section class="w-100">
  <div class="row w-100">
    <div class=" col-lg-8 col-md-12 col-sm-12 mb-lg-0 mb-sm-3 mb-md-3 mb-3">
      <div class="default-card p-4" style="height: 100%">
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <p class="mt-0">Gráfico do tempo durante a semana</p>
          </div>
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-calendar"></i>
            <p class="text-primary mb-0">{{ hoje|date:" F Y" }}</p>
          </div>
        </div>
        <div class="chart">
          <canvas id="chart" data-url="{% url 'chart-data' %}"></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-12 col-sm-12">
  <div class="default-card">
    <div class="d-flex justify-content-between pb-2">
      <div class="d-flex align-items-center">
        <p class="mt-0">Média das informações</p>
      </div>
      <div class="d-flex align-items-center btn-select custom-select-wrapper">
        <select id="date" class="custom-select">
          <option value="mes">Mês</option>
          <option value="semana">Semana</option>
        </select>
      </div>
    </div>

    <div id="valores-media">
      <div class="d-flex justify-content-between pb-2">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-thermometer-sun"></i>
          <p class="m-0">Temperatura</p>
        </div>
        <p class="m-0" id="temp">{{ medias_mes.temp|default:"—"|floatformat:1 }}ºC</p>
      </div>
      <div class="d-flex justify-content-between pb-2">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-brightness-high"></i>
          <p class="m-0">Luminosidade</p>
        </div>
        <p class="m-0" id="lum">{{ medias_mes.lum|default:"—"|floatformat:1 }}%</p>
      </div>
      <div class="d-flex justify-content-between pb-2">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-droplet"></i>
          <p class="m-0">Umidade do solo</p>
        </div>
        <p class="m-0" id="solo">{{ medias_mes.solo|default:"—"|floatformat:1 }}%</p>
      </div>
      <div class="d-flex justify-content-between pb-2">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-water"></i>
          <p class="m-0">Umidade do ar</p>
        </div>
        <p class="m-0" id="ar">{{ medias_mes.ar|default:"—"|floatformat:1 }}%</p>
      </div>
      <div class="d-flex justify-content-between pb-2">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-cloud-drizzle"></i>
          <p class="m-0">Chuva</p>
        </div>
        <p class="m-0" id="chuva">{{ medias_mes.chuva|default:"—"|floatformat:1 }}%</p>
      </div>
    </div>
  </div>
</div>

  </div>
</section>

<section class="default-card mt-4">
  <p class="fw-bold fs-4">Gerador de Relatórios</p>

  <!-- o form agora aponta para a view Django -->
  <form class="mb-4" method="get" action="{% url 'gerar_relatorio' %}">
    <div class="row g-4">
      <div class="col-md-6 d-flex gap-4">
        <div class="flex-fill">
          <label for="dataInicial">Data Inicial</label>
          <input type="date" class="form-control input-style" id="dataInicial" name="data_inicial" />
        </div>
        <div class="flex-fill">
          <label for="dataFinal">Data Final</label>
          <input type="date" class="form-control input-style" id="dataFinal" name="data_final" />
        </div>
      </div>

      <div class="col-md-6 d-flex gap-4">
        <div class="flex-fill">
          <label for="horaInicial">Hora Inicial</label>
          <input type="time" class="form-control input-style" id="horaInicial" name="hora_inicial" />
        </div>
        <div class="flex-fill">
          <label for="horaFinal">Hora Final</label>
          <input type="time" class="form-control input-style" id="horaFinal" name="hora_final" />
        </div>
      </div>

      <div class="col-12">
        <fieldset class="dados">
          <p class="mt-1 fw-bold">Dados</p>
          <div class="d-flex flex-wrap gap-4 text-secondary">
            <div>
              <input class="form-check-input" type="checkbox" id="temperatura" name="campos" value="temperatura" />
              <label class="form-check-label" for="temperatura">Temperatura</label>
            </div>
            <div>
              <input class="form-check-input" type="checkbox" id="umidadeAr" name="campos" value="umidade_ar" />
              <label class="form-check-label" for="umidadeAr">Umidade do Ar</label>
            </div>
            <div>
              <input class="form-check-input" type="checkbox" id="chuva" name="campos" value="chuva" />
              <label class="form-check-label" for="chuva">Chuva</label>
            </div>
            <div>
              <input class="form-check-input" type="checkbox" id="luminosidade" name="campos" value="luminosidade" />
              <label class="form-check-label" for="luminosidade">Luminosidade</label>
            </div>
            <div>
              <input class="form-check-input" type="checkbox" id="umidadeSolo" name="campos" value="umidade_solo" />
              <label class="form-check-label" for="umidadeSolo">Umidade do Solo</label>
            </div>
            <div>
              <input class="form-check-input" type="checkbox" id="uv" name="campos" value="uv" />
              <label class="form-check-label" for="uv">UV</label>
            </div>
          </div>
        </fieldset>
      </div>

      <div class="btn-style mt-3 d-flex justify-content-end w-100">
        <button type="submit" class="btn">Gerar relatório</button>
      </div>
    </div>
  </form>
</section>



<script>
  const select = document.getElementById("date");

  // dados passados pelo Django (transforma em JSON)
  const mediasMes = {
    temp: "{{ medias_mes.temp|default:0|floatformat:1 }}",
    lum: "{{ medias_mes.lum|default:0|floatformat:1 }}",
    solo: "{{ medias_mes.solo|default:0|floatformat:1 }}",
    ar: "{{ medias_mes.ar|default:0|floatformat:1 }}",
    chuva: "{{ medias_mes.chuva|default:0|floatformat:1 }}"
  };

  const mediasSemana = {
    temp: "{{ medias_semana.temp|default:0|floatformat:1 }}",
    lum: "{{ medias_semana.lum|default:0|floatformat:1 }}",
    solo: "{{ medias_semana.solo|default:0|floatformat:1 }}",
    ar: "{{ medias_semana.ar|default:0|floatformat:1 }}",
    chuva: "{{ medias_semana.chuva|default:0|floatformat:1 }}"
  };

  select.addEventListener("change", function () {
    const periodo = this.value === "semana" ? mediasSemana : mediasMes;

    document.getElementById("temp").textContent = periodo.temp + "ºC";
    document.getElementById("lum").textContent = periodo.lum + "%";
    document.getElementById("solo").textContent = periodo.solo + "%";
    document.getElementById("ar").textContent = periodo.ar + "%";
    document.getElementById("chuva").textContent = periodo.chuva + "%";
  });
</script>



{% endblock %}
