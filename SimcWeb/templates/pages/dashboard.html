{% extends 'layout/layout.html' %} {% block title %} Dashboard {% endblock %}
{%block content %}

<section id="bgClimate" class="bg-climate container-climate w-100">
  <div class="current-weather w-100 d-flex justify-content-between p-5">
    <div class="d-flex align-items-center gap-4">
      <div>
        <i class="{{ icone_hoje }} fw-bold text-white" style="font-size: 90px"></i>
      </div>
      <div>
        {% if medicao %}
        <p class="fs-1 fw-bold text-white mb-0" id="temperatura">
          {{ medicao.temperatura|floatformat:0 }}
        </p>
        {% endif %}
        <p class="text-white">Sensação térmica: 32°C</p>
      </div>
    </div>
    <div class="last-week d-flex gap-5">
      {% for dia in dias_passados %}
      <div class="d-flex flex-column align-items-center">
        <p class="fw-bold text-white">{{ dia.dia|date:"l" }}</p>
        <i class="{{ dia.icone }} fs-1 fw-bold text-white"></i>
        {% if dia.media %}
        <p class="fw-bold text-white pt-2">{{ dia.media }}°C</p>
        {% else %}
        <p class="fw-bold text-white pt-2">—</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<section
  class="weather-metrics gap-3 pt-4 d-flex flex-wrap justify-content-start w-100"
>
  {% if medicao %}
  <div class="card-metric p-4 d-flex justify-content-between">
    <div>
      <p class="mb-0 fw-bold">Luminosidade</p>
      <p data-metric="luminosidade" class="fw-bold fs-3 mb-0">
        {{ medicao.luminosidade }}
      </p>
    </div>
    <div class="icon">
      <i class="bi bi-sun text-secondary"></i>
    </div>
  </div>

  <div class="card-metric p-4 d-flex justify-content-between">
    <div>
      <p class="mb-0 fw-bold">Umidade do ar</p>
      <p data-metric="umidade_ar" class="fw-bold fs-3 mb-0">
        {{ medicao.umidade_ar }}
      </p>
    </div>
    <div class="icon">
      <i class="bi bi-droplet text-secondary"></i>
    </div>
  </div>

  <div class="card-metric p-4 d-flex justify-content-between">
    <div>
      <p class="mb-0 fw-bold">Umidade do solo</p>
      <p data-metric="umidade_solo" class="fw-bold fs-3 mb-0">
        {{ medicao.umidade_solo }}
      </p>
    </div>
    <div class="icon">
      <i class="bi bi-droplet text-secondary"></i>
    </div>
  </div>

  <div class="card-metric p-4 d-flex justify-content-between">
    <div>
      <p class="mb-0 fw-bold">Chuva</p>
      <p data-metric="chuva" class="fw-bold fs-3 mb-0">{{ medicao.chuva }}</p>
    </div>
    <div class="icon">
      <i class="bi bi-cloud-drizzle text-secondary"></i>
    </div>
  </div>

  <div class="card-metric p-4 d-flex justify-content-between">
    <div>
      <p class="mb-0 fw-bold">Velocidade do vento</p>
      <p data-metric="velocidade_vento" class="fw-bold fs-3 mb-0">
        {{ medicao.velocidade_vento }}
      </p>
    </div>
    <div class="icon">
      <i class="bi bi-wind text-secondary"></i>
    </div>
  </div>

  <div class="card-metric p-4 d-flex justify-content-between">
    <div>
      <p class="mb-0 fw-bold">Índice Ultravioleta</p>
      <p data-metric="uv" class="fw-bold fs-3 mb-0">{{ medicao.uv }}</p>
    </div>
    <div class="icon">
      <i class="bi bi-sun text-secondary"></i>
    </div>
  </div>
  {% else %}
  <p>Nenhuma medicaoição encontrada.</p>
  {% endif %}
</section>

<section class="default-card mt-4">
  <p class="fw-bold fs-4">Previsão para os próximos dias</p>
  {% if previsao %} {% for dia in previsao %}
  <div class="d-flex justify-content-between pb-2">
    <div class="d-flex align-items-center gap-2">
      <i class="bi bi-cloud-lightning-rain"></i>
      <p class="m-0">{{ dia.dia }}: {{ dia.descricao }}</p>
      <p></p>
    </div>
    <div class="d-flex align-items-center">
      <p class="m-0">
        {{ dia.temp_min|floatformat:1 }}° min / {{ dia.temp_max|floatformat:1 }}° max
      </p>
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="text-center py-4">
    <i class="bi bi-exclamation-triangle text-warning fs-3"></i>
    <p class="mt-2 text-muted">Previsão do tempo não disponível no momento</p>
    <small class="text-muted">Verifique sua conexão com a internet</small>
  </div>
  {% endif %}
</section>
<!-- Ajax -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  function atualizarDados() {
    $.ajax({
      url: "{% url 'dashboard' %}", // Certifique-se de que a URL está correta
      type: "GET",
      headers: {
        "X-Requested-With": "XMLHttpRequest",
      },
      success: function (data) {
        // Atualiza os elementos com os novos dados
        $("#temperatura").text(data.temperatura + "°C"); // Exemplo para temperatura
        $('[data-metric="luminosidade"]').text(data.luminosidade);
        $('[data-metric="umidade_ar"]').text(data.umidade_ar + "%");
        $('[data-metric="umidade_solo"]').text(data.umidade_solo + "%");
        $('[data-metric="chuva"]').text(data.chuva);
        $('[data-metric="uv"]').text(data.uv);
        // Atualiza a última atualização
        $("#ultima-atualizacao").text(data.ultima_atualizacao);
      },
      error: function (xhr) {
        console.error("Erro ao buscar dados:", xhr.responseText);
      },
    });
  }

  // Chama a função a cada 10 segundos (10000 milissegundos)
  setInterval(atualizarDados, 10000);
</script>

{% endblock %}
